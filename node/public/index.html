<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoBroko Bot - Stock View</title>
<meta name="theme-color" content="#020617">
<style>
:root {
  --bg: #020617;
  --header: #1f2937;
  --primary: #22c55e;
  --bot: #1f2937;
  --user: #22c55e;
  --text: #e5e7eb;
  --card-bg: #1f2937;
  --card-border: #374151;
}

* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: Inter, system-ui, Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
}

.app {
  max-width: 400px;
  margin: 0 auto;
  border-radius: 28px;
  overflow: hidden;
  box-shadow: 0 30px 80px rgba(0,0,0,.8);
  background: var(--bg);
  display: flex;
  flex-direction: column;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--header);
  padding: 12px 16px;
  border-bottom: 1px solid #374151;
}

header h1 {
  font-size: 1.2rem;
  font-weight: bold;
}

header .price {
  font-weight: normal;
  font-size: 1rem;
}

#chat-container {
  flex-grow: 1;
  overflow-y: auto;
  padding: 10px;
}

.stock-card {
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  margin: 10px 0;
  border-radius: 12px;
  padding: 10px 14px;
}

.stock-card .row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-size: 0.9rem;
}

.stock-card .sentiment {
  display: flex;
  justify-content: space-between;
  margin-bottom: 6px;
  font-weight: bold;
}

.stock-card .explanation {
  font-size: 0.8rem;
  margin-bottom: 6px;
  font-style: italic;
  color: #9ca3af;
}

.stock-card .entry-alert {
  border: 1px solid var(--card-border);
  border-radius: 8px;
  padding: 6px 10px;
  margin-bottom: 6px;
  font-size: 0.9rem;
}

.stock-card pre {
  background: #111827;
  padding: 8px;
  border-radius: 8px;
  overflow-x: auto;
  font-size: 0.8rem;
  margin-bottom: 6px;
}

.chart-placeholder {
  width: 100%;
  height: 120px;
  background: #111827;
  border-radius: 8px;
  margin-bottom: 10px;
}

.action-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.action-buttons button {
  flex: 1;
  padding: 10px 0;
  border-radius: 20px;
  border: none;
  cursor: pointer;
  font-weight: bold;
  font-size: 0.9rem;
}

.add-watchlist { background: var(--primary); color: #000; }
.set-alert { background: #2563eb; color: #fff; }

.user-msg, .bot-msg {
  display: flex;
  flex-direction: column;
  margin-bottom: 10px;
}

.user-msg { align-items: flex-end; }
.bot-msg { align-items: flex-start; }

.msg-content {
  max-width: 90%;
  padding: 10px 14px;
  border-radius: 16px;
  word-wrap: break-word;
  background: var(--bot);
  color: var(--text);
}

.user-msg .msg-content {
  background: var(--user);
  color: #022c22;
}

#chat-form {
  display: flex;
  gap: 8px;
  padding: 12px;
  border-top: 1px solid #1f2937;
  background: var(--bg);
  position: fixed;
  bottom: 0;
  width: 100%;
  max-width: 400px;
}

#message-input {
  flex: 1;
  padding: 10px 14px;
  border-radius: 24px;
  border: 1px solid #374151;
  background: #020617;
  color: var(--text);
}

#chat-form button {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--primary);
  font-size: 1.25rem;
  cursor: pointer;
}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1 id="stock-symbol">Stock</h1>
    <span class="price" id="stock-price">â‚¹0.00 0%</span>
  </header>

  <div id="chat-container">
    <!-- Dynamic Stock Card will be injected here -->
    <div id="stock-card-container"></div>

    <!-- Chat messages -->
    <div id="messages" class="ScrollStyle"></div>
  </div>

  <form id="chat-form">
    <input id="message-input" placeholder="Ask about a stockâ€¦">
    <button type="submit">âž¤</button>
  </form>
</div>

<script src="app.js?v=76"></script>
<script>
const chatForm = document.getElementById('chat-form');
const messageInput = document.getElementById('message-input');
const messagesEl = document.getElementById('messages');
const stockCardContainer = document.getElementById('stock-card-container');
const stockSymbolEl = document.getElementById('stock-symbol');
const stockPriceEl = document.getElementById('stock-price');

// Dummy function to simulate fetching stock data
async function fetchStockData(symbol) {
  // Replace this with your API call
  return {
    symbol: symbol.toUpperCase(),
    price: (Math.random()*1000).toFixed(2),
    change: '+2.3%',
    low: (Math.random()*900).toFixed(2),
    high: (Math.random()*1000).toFixed(2),
    volume: (Math.random()*5).toFixed(1) + 'M',
    avgVol: (Math.random()*5).toFixed(1) + 'M',
    sentiment: 'Bullish ðŸ”¥',
    confidence: 0.82,
    explanation: 'Accumulation detected',
    entryRange: '435 - 445',
    alert: 'Buy Signal',
    aiAnalysis: {
      predicted_move: 'up',
      confidence: 0.8,
      support_level: 440,
      resistance_level: 455,
      risk: 'moderate',
      recommendation: 'buy'
    }
  };
}

function renderStockCard(data) {
  stockSymbolEl.textContent = data.symbol;
  stockPriceEl.textContent = `â‚¹${data.price} ${data.change}`;

  stockCardContainer.innerHTML = `
    <div class="stock-card">
      <div class="row">
        <span>Low: â‚¹${data.low}</span>
        <span>High: â‚¹${data.high}</span>
      </div>
      <div class="row">
        <span>Volume: ${data.volume}</span>
        <span>Avg Vol: ${data.avgVol}</span>
      </div>
      <div class="sentiment">
        <span>Sentiment: ${data.sentiment}</span>
        <span>Confidence: ${data.confidence}</span>
      </div>
      <div class="explanation">Explanation: ${data.explanation}</div>
      <div class="entry-alert">
        Entry Range: â‚¹${data.entryRange}<br>
        Alert: ${data.alert}
      </div>
      <pre>${JSON.stringify(data.aiAnalysis, null, 2)}</pre>
      <div class="chart-placeholder">[Candlestick Chart]</div>
      <div class="action-buttons">
        <button class="add-watchlist">Add to Watchlist</button>
        <button class="set-alert">Set Alert</button>
      </div>
    </div>
  `;
}

// Handle chat form submit
chatForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const msg = messageInput.value.trim();
  if (!msg) return;

  // Show user message
  const userDiv = document.createElement('div');
  userDiv.className = 'user-msg';
  userDiv.innerHTML = `<div class="msg-content">${msg}</div>`;
  messagesEl.appendChild(userDiv);

  // Clear input
  messageInput.value = '';
  messagesEl.scrollTop = messagesEl.scrollHeight;

  // Fetch stock data dynamically
  const data = await fetchStockData(msg);
  renderStockCard(data);

  // Bot response example
  const botDiv = document.createElement('div');
  botDiv.className = 'bot-msg';
  botDiv.innerHTML = `<div class="msg-content">Here is the analysis for ${data.symbol}</div>`;
  messagesEl.appendChild(botDiv);
  messagesEl.scrollTop = messagesEl.scrollHeight;
});
</script>
</body>
</html>
